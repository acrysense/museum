"use strict";

function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }
function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
document.addEventListener('DOMContentLoaded', function () {
  // inputmask
  Inputmask().mask(document.querySelectorAll('input'));

  // checker
  var useItemChecker = function useItemChecker(els, onClickOutside) {
    var checkBodyClick = function checkBodyClick(e) {
      var currentEl = e.target;
      while (currentEl) {
        if (els.includes(currentEl)) break;
        currentEl = currentEl.parentNode;
      }
      if (!currentEl) {
        onClickOutside();
        removeBodyChecker();
      }
    };
    function setBodyChecker() {
      document.documentElement.addEventListener('click', checkBodyClick);
    }
    function removeBodyChecker() {
      document.documentElement.removeEventListener('click', checkBodyClick);
    }
    return {
      setBodyChecker: setBodyChecker,
      removeBodyChecker: removeBodyChecker
    };
  };

  // functions
  function setLineClamp(element, maxHeight) {
    var lineHeight = parseFloat(getComputedStyle(element).lineHeight);
    var clampValue = Math.floor(maxHeight / lineHeight);
    element.style.setProperty('-webkit-line-clamp', clampValue);
  }
  function mainItemGetHeight(items) {
    items.forEach(function (item) {
      var contentBlockHeight = item.clientHeight;
      var title = item.querySelector('.main__title');
      var description = item.querySelector('.main__description');
      if (title && description) {
        var titleHeight = title.getBoundingClientRect().height;
        var remainingHeight = contentBlockHeight - titleHeight - parseInt(getComputedStyle(description).paddingTop);
        if (remainingHeight > 0) {
          setLineClamp(description, remainingHeight);
        } else {
          setLineClamp(description, 0);
        }
      }
    });
  }

  // mobile menu
  var mobileMenu = document.getElementById('menu');
  var mobileMenuTrigger = document.getElementById('hamburger-toggle');
  var mobileMenuClose = document.querySelector('.menu__close');
  if (mobileMenu && mobileMenuTrigger) {
    mobileMenuTrigger.addEventListener('click', function (event) {
      event.preventDefault();
      if (mobileMenu.classList.contains('is--active')) {
        mobileMenu.classList.remove('is--active');
        document.body.classList.remove('scroll-disabled');
      } else {
        mobileMenu.classList.add('is--active');
        document.body.classList.add('scroll-disabled');
      }
    });
    if (mobileMenuClose) {
      mobileMenuClose.addEventListener('click', function (event) {
        event.preventDefault();
        if (mobileMenu.classList.contains('is--active')) {
          mobileMenu.classList.remove('is--active');
          document.body.classList.remove('scroll-disabled');
        }
      });
    }
  }

  // search
  var search = document.querySelector('.c-search');
  var searchClose = document.querySelector('.c-search__close');
  var searchTrigger = document.querySelectorAll('.c-search-trigger__btn');
  if (search && searchTrigger && searchClose) {
    searchTrigger.forEach(function (item) {
      item.addEventListener('click', function (event) {
        event.preventDefault();
        if (!search.classList.contains('is--active')) {
          search.classList.add('is--active');
        }
      });
    });
    searchClose.addEventListener('click', function (event) {
      event.preventDefault();
      var input = search.querySelector('.c-search__input');
      if (search.classList.contains('is--active')) {
        search.classList.remove('is--active');
        if (input) {
          input.value = '';
        }
      }
    });
  }

  // toggle invert
  var toggleInvert = document.querySelectorAll('.toggle-invert');
  if (toggleInvert) {
    toggleInvert.forEach(function (item) {
      item.addEventListener('click', function (event) {
        event.preventDefault();
        document.body.classList.toggle('invert');
      });
    });
  }

  // select
  var selected = document.querySelectorAll('.select-box__selected');
  var optionsList = document.querySelectorAll('.select-box__option');
  if (selected) {
    selected.forEach(function (item) {
      var close = function close() {
        document.querySelectorAll('.select-box__container').forEach(function (child) {
          child.classList.remove('select-box__container--active');
          child.removeAttribute('style');
        });
        document.querySelectorAll('.select-box__selected').forEach(function (child) {
          return child.classList.remove('select-box__selected--active');
        });
      };
      var itemChecker = useItemChecker([item.parentNode].concat(_toConsumableArray(selected)), close);
      item.addEventListener('click', function () {
        var container = item.previousElementSibling;
        if (container.classList.contains('select-box__container--active')) {
          close();
        } else {
          close();
          container.classList.add('select-box__container--active');
          item.classList.add('select-box__selected--active');
          itemChecker.setBodyChecker();
        }
      });
    });
  }
  if (optionsList) {
    optionsList.forEach(function (option) {
      option.addEventListener('click', function (event) {
        event.preventDefault();
        var parent = option.closest('.select-box');
        var currentContainer = parent.querySelector('.select-box__container');
        var currentSelected = parent.querySelector('.select-box__selected');
        var currentSelectedPlaceholder = currentSelected.querySelector('.select-box__placeholder');
        var currentSelectedValue = currentSelected.querySelector('.select-box__values');
        if (option.querySelector('input').checked) {
          return false;
        } else {
          option.querySelector('input').checked = true;
        }
        if (currentSelectedPlaceholder.classList.contains('select-box__placeholder--active')) {
          currentSelectedPlaceholder.classList.remove('select-box__placeholder--active');
          currentSelectedValue.classList.add('select-box__values--active');
        }
        currentSelectedValue.innerHTML = option.querySelector('.select-box__label').innerHTML;
        currentContainer.classList.remove('select-box__container--active');
        currentSelected.classList.remove('select-box__selected--active');
      });
    });
  }

  // alphabet filters
  var residentsFilterList = document.querySelectorAll('.residents-alphabet__item');
  var residentsFilterBtn = document.querySelectorAll('.residents-filter__btn');
  if (residentsFilterList && residentsFilterBtn) {
    residentsFilterBtn.forEach(function (button) {
      button.addEventListener('click', function () {
        var isActive = button.classList.contains('is--active');
        document.querySelectorAll('.residents-filter__btn').forEach(function (btn) {
          return btn.classList.remove('is--active');
        });
        if (isActive) {
          residentsFilterList.forEach(function (list) {
            list.classList.remove('is--hidden');
            list.querySelectorAll('.residents-alphabet__list-item').forEach(function (item) {
              item.style.display = '';
            });
          });
        } else {
          button.classList.add('is--active');
          var filterId = button.getAttribute('data-id');
          residentsFilterList.forEach(function (list) {
            var hasVisibleItems = false;
            list.querySelectorAll('.residents-alphabet__list-item').forEach(function (item) {
              var itemId = item.getAttribute('data-id');
              if (itemId === filterId) {
                item.style.display = '';
                hasVisibleItems = true;
              } else if (itemId) {
                item.style.display = 'none';
              }
            });
            if (!hasVisibleItems) {
              list.classList.add('is--hidden');
            } else {
              list.classList.remove('is--hidden');
            }
          });
        }
      });
    });
  }

  // js columns
  var jsContent = document.querySelectorAll('.js-content');
  function generateContentColumns(contents) {
    if (contents) {
      contents.forEach(function (item) {
        var parent = item.closest('.js-content-wrapper');
        var columnsContainer = parent.querySelector('.js-content-columns');
        var columns = Array.from(columnsContainer.querySelectorAll('.js-content-column'));
        var images = Array.from(item.querySelectorAll('img'));
        var width = columns[0].getBoundingClientRect().width;
        var height = width * 1.361904761904762;
        var fontSize = 16;
        var lineHeight = 1.375;
        var lineHeightPx = fontSize * lineHeight;
        var maxLines = Math.floor(height / lineHeightPx);
        var adjustedMaxHeight = maxLines * lineHeightPx;
        columns.forEach(function (column) {
          if (column.classList.contains('js-content-column--empty')) {
            column.classList.remove('js-content-column--empty');
          }
          column.querySelector('.js-content-column-inner').innerHTML = '';
          column.style.height = "".concat(adjustedMaxHeight, "px");
        });
        var columnHeight = Number(columns[0].getBoundingClientRect().height);
        var fullText = Array.from(item.querySelectorAll('p')).map(function (p) {
          return p.innerHTML.trim();
        }).join(' ||BR|| ');
        var words = fullText.split(' ');
        var currentColumn = 0;
        var index = 0;
        var remainingText = '';
        function distributeTextInChunks() {
          if (currentColumn >= columns.length) return;
          var column = columns[currentColumn].querySelector('.js-content-column-inner');
          var tempText = remainingText || "";
          while (index < words.length) {
            tempText += (tempText ? " " : "") + words[index];
            if (window.innerWidth >= 768) {
              column.innerHTML = tempText.replace(/ \|\|BR\|\| /g, '<br><br>');
            } else {
              column.innerHTML = tempText.replace(/ \|\|BR\|\| /g, '<br>');
            }
            index++;
            if (column.scrollHeight > columnHeight) {
              tempText = tempText.substring(0, tempText.lastIndexOf(' '));
              if (window.innerWidth >= 768) {
                column.innerHTML = tempText.replace(/ \|\|BR\|\| /g, '<br><br>');
              } else {
                column.innerHTML = tempText.replace(/ \|\|BR\|\| /g, '<br>');
              }
              remainingText = words[index - 1] + " ";
              currentColumn++;
              distributeTextInChunks();
              return;
            }
          }
          remainingText = '';
        }
        distributeTextInChunks();
        var imageIndex = 0;
        columns.forEach(function (column, i) {
          var columnInner = column.querySelector('.js-content-column-inner');
          columnInner.innerHTML = columnInner.innerHTML.replace(/ \|\|BR\|\|/g, '');
          if (!columnInner.innerHTML.trim() && imageIndex < images.length) {
            var img = images[imageIndex].cloneNode(true);
            if (window.innerWidth >= 1200) {
              if (img.classList.contains('wide') && columns[i + 1] && i + 1 < 5) {
                img.style.width = Number(width * 2) + parseInt(getComputedStyle(columnsContainer).columnGap) + 'px';
                img.style.minWidth = Number(width * 2) + parseInt(getComputedStyle(columnsContainer).columnGap) + 'px';
                column.classList.add('js-content-column--img');
              }
              columnInner.appendChild(img);
            } else {
              if (img.classList.contains('wide')) {
                if (i % 2 === 1) {
                  if (columns[i + 1] && columns[i + 2]) {
                    img.style.width = Number(width * 2) + parseInt(getComputedStyle(columnsContainer).columnGap) + 'px';
                    img.style.minWidth = Number(width * 2) + parseInt(getComputedStyle(columnsContainer).columnGap) + 'px';
                    column.classList.add('js-content-column--plug');
                    columns[i + 1].classList.add('js-content-column--img');
                    columns[i + 1].querySelector('.js-content-column-inner').appendChild(img);
                  }
                } else {
                  img.style.width = Number(width * 2) + parseInt(getComputedStyle(columnsContainer).columnGap) + 'px';
                  img.style.minWidth = Number(width * 2) + parseInt(getComputedStyle(columnsContainer).columnGap) + 'px';
                  column.classList.add('js-content-column--img');
                  columnInner.appendChild(img);
                }
              } else {
                columnInner.appendChild(img);
              }
            }
            imageIndex++;
          }
          if (!columnInner.innerHTML.trim()) {
            column.classList.add('js-content-column--empty');
          } else {
            column.classList.remove('js-content-column--empty');
          }
        });
      });
    }
  }
  generateContentColumns(jsContent);

  // main dynamic
  var mainItems = document.querySelectorAll('.main__item');
  if (mainItems) {
    mainItemGetHeight(mainItems);
  }

  // window
  window.addEventListener('resize', function () {
    if (mainItems) {
      mainItemGetHeight(mainItems);
    }
    if (jsContent) {
      jsContent.forEach(function (item) {
        var columnsContainer = item.closest('.js-content-wrapper').querySelector('.js-content-columns');
        var columns = Array.from(columnsContainer.querySelectorAll('.js-content-column'));
        columns.forEach(function (column) {
          column.removeAttribute('style');
          column.classList.remove('js-content-column--empty');
          column.querySelector('.js-content-column-inner').innerHTML = '';
        });
      });
      generateContentColumns(jsContent);
    }
  });

  // modal
  var modal = document.querySelectorAll('.modal');
  var modalBtn = document.querySelectorAll('.modal-btn');
  var modalClose = document.querySelectorAll('.modal__close');
  if (modal && modalBtn && modalClose) {
    // modal
    modal.forEach(function (item) {
      item.addEventListener('click', function (event) {
        if (event.target.classList.contains('modal') || event.target.classList.contains('modal__wrap')) {
          event.preventDefault();
          document.querySelectorAll('.modal.is--active').forEach(function (child) {
            return child.classList.remove('is--active');
          });
          document.body.classList.remove('scroll-disabled');
        }
      });
    });

    // modal btn
    modalBtn.forEach(function (item, i) {
      item.addEventListener('click', function (event) {
        event.preventDefault();
        var modalID = item.dataset.id;
        document.querySelectorAll('.modal.is--active').forEach(function (child) {
          return child.classList.remove('is--active');
        });
        document.getElementById(modalID).classList.add('is--active');
        document.body.classList.add('scroll-disabled');
      });
    });

    // modal close
    modalClose.forEach(function (item) {
      item.addEventListener('click', function (event) {
        event.preventDefault();
        var parent = item.closest('.modal');
        var modalID = parent.id;
        document.querySelectorAll('.modal.is--active').forEach(function (child) {
          return child.classList.remove('is--active');
        });
        document.body.classList.remove('scroll-disabled');
      });
    });
  }

  // tickets
  var ticketsContents = document.querySelectorAll('.tickets__content');
  var ticketsMoreButtons = document.querySelectorAll('.tickets__more');
  if (ticketsContents && ticketsMoreButtons) {
    ticketsContents.forEach(function (content) {
      if (content.offsetHeight > 156) {
        content.classList.add('tickets__content--short');
        content.classList.add('is--short');
        content.style.setProperty('--full-height', "".concat(content.scrollHeight, "px"));
      } else {
        content.classList.remove('tickets__content--short');
        content.classList.remove('is--short');
      }
    });
    ticketsMoreButtons.forEach(function (button) {
      button.addEventListener('click', function (event) {
        event.preventDefault();
        var parent = button.closest('.tickets__info');
        var content = parent.querySelector('.tickets__content');
        if (content.classList.contains('is--short')) {
          content.classList.remove('is--short');
          button.classList.add('is--shorty');
          button.querySelector('span').innerHTML = 'скрыть';
        } else {
          content.classList.add('is--short');
          button.classList.remove('is--shorty');
          button.querySelector('span').innerHTML = 'раскрыть';
        }
      });
    });
  }
});