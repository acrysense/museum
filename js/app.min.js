"use strict";

document.addEventListener('DOMContentLoaded', function () {
  // functions
  function setLineClamp(element, maxHeight) {
    var lineHeight = parseFloat(getComputedStyle(element).lineHeight);
    var clampValue = Math.floor(maxHeight / lineHeight);
    element.style.setProperty('-webkit-line-clamp', clampValue);
  }
  function mainItemGetHeight(items) {
    items.forEach(function (item) {
      var contentBlockHeight = item.clientHeight;
      var title = item.querySelector('.main__title');
      var description = item.querySelector('.main__description');
      if (title && description) {
        var titleHeight = title.getBoundingClientRect().height;
        var remainingHeight = contentBlockHeight - titleHeight - parseInt(getComputedStyle(description).paddingTop);
        if (remainingHeight > 0) {
          setLineClamp(description, remainingHeight);
        } else {
          setLineClamp(description, 0);
        }
      }
    });
  }

  // mobile menu
  var mobileMenu = document.getElementById('menu');
  var mobileMenuTrigger = document.getElementById('hamburger-toggle');
  var mobileMenuClose = document.querySelector('.menu__close');
  if (mobileMenu && mobileMenuTrigger) {
    mobileMenuTrigger.addEventListener('click', function (event) {
      event.preventDefault();
      if (mobileMenu.classList.contains('is--active')) {
        mobileMenu.classList.remove('is--active');
        document.body.classList.remove('scroll-disabled');
      } else {
        mobileMenu.classList.add('is--active');
        document.body.classList.add('scroll-disabled');
      }
    });
    if (mobileMenuClose) {
      mobileMenuClose.addEventListener('click', function (event) {
        event.preventDefault();
        if (mobileMenu.classList.contains('is--active')) {
          mobileMenu.classList.remove('is--active');
          document.body.classList.remove('scroll-disabled');
        }
      });
    }
  }

  // main dynamic
  var mainItems = document.querySelectorAll('.main__item');
  if (mainItems) {
    mainItemGetHeight(mainItems);
  }

  // resident
  // function splitTextIntoColumns(textBlock, columnWidth, heightRatio) {
  //     const maxHeight = columnWidth * heightRatio; // Максимальная высота для колонки
  //     const text = textBlock.textContent.trim(); // Получаем текст
  //     const words = text.split(' '); // Разбиваем текст на слова
  //     let currentHeight = 0;
  //     let currentColumnText = ''; // Для текущего параграфа
  //     let nextColumnText = ''; // Текст для следующей колонки
  //     let tempParagraph = document.createElement('p'); // Временный параграф для измерений

  //     // Проверяем каждое слово, добавляя его к параграфу
  //     for (let word of words) {
  //       tempParagraph.textContent = currentColumnText + ' ' + word;
  //       textBlock.appendChild(tempParagraph);

  //       // Если текст превышает максимальную высоту, переносим оставшийся текст
  //       if (textBlock.scrollHeight > maxHeight) {
  //         nextColumnText = words.slice(words.indexOf(word)).join(' '); // Оставшийся текст
  //         break;
  //       }

  //       // Если высота не превышена, добавляем слово к текущему тексту
  //       currentColumnText += ' ' + word;
  //       textBlock.removeChild(tempParagraph); // Удаляем временный элемент после проверки
  //     }

  //     // Устанавливаем текст для текущей колонки
  //     textBlock.textContent = currentColumnText.trim();

  //     // Если есть текст для следующей колонки, создаём новую колонку
  //     if (nextColumnText.trim()) {
  //       const newColumn = document.createElement('div');
  //       newColumn.classList.add('resident__content-block');
  //       newColumn.innerHTML = `<p>${nextColumnText.trim()}</p>`;
  //       textBlock.parentNode.appendChild(newColumn);

  //       // Рекурсивно вызываем функцию для переноса оставшегося текста
  //       splitTextIntoColumns(newColumn, columnWidth, heightRatio);
  //     }
  // }

  // const textBlock = document.querySelector('.resident__content-block');
  // const columnWidth = 210; // Ширина колонки
  // const heightRatio = 1.3667; // Высота 136.67% от ширины

  // splitTextIntoColumns(textBlock, columnWidth, heightRatio);

  // window
  window.addEventListener('resize', function () {
    if (mainItems) {
      mainItemGetHeight(mainItems);
    }
  });
});